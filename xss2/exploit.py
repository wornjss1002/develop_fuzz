from typing import List
from data_models import FinalReportData, FinalExploitReport, IExploitCheck

from plugin.exploit.cookie_leak import CookieLeak

class XssExploitModule:
    def __init__(self, callback_server_url: str):
        self.callback_server = callback_server_url
        self.checkers: List[IExploitCheck] = [
            CookieLeak(),
        ]
        print(f"[+] 익스플로잇 모듈: {len(self.checkers)}개의 시나리오 플러그인 로드 완료.")

    def analyze_and_report(self, data: FinalReportData) -> FinalExploitReport:
        all_scenarios = []
        for checker in self.checkers:
            scenario_result = checker.check(data, self.callback_server)
            if scenario_result:
                all_scenarios.append(scenario_result)
        final_report = FinalExploitReport(
            injection_point=data.point,
            successful_payload=data.result.successful_payload,
            scenarios=all_scenarios
        )
        
        return final_report
